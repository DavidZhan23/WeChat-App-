# 前端测试步骤 - 小程序本地测试

## ✅ 当前状态确认

你的后端服务已经成功启动！
- ✅ 后端服务运行在 `http://localhost:3000`
- ✅ 健康检查接口正常：`{"status":"ok","message":"服务运行正常"}`
- ✅ 数据库配置已完成

## 关于数据库自动存储

**是的，数据库已经配置好了！** 当你的小程序运行后：

1. **用户登录时**：会自动在 `users` 表中创建/更新用户信息
2. **同步步数时**：会自动在 `steps_records` 表中保存步数记录
3. **查询数据时**：会自动从数据库读取统计数据

**你不需要手动操作数据库**，所有数据存储和读取都是自动的！

---

## 第一步：准备微信开发者工具

### 1.1 下载安装（如果还没安装）

访问：https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html

下载并安装 **微信开发者工具**

### 1.2 获取 AppID

**选项A：使用正式 AppID（推荐）**
1. 访问 https://mp.weixin.qq.com
2. 登录你的小程序账号
3. 在"开发" → "开发管理" → "开发设置" 中找到 **AppID**

**选项B：使用测试号（临时测试）**
1. 在微信开发者工具中，选择"测试号"
2. 会自动生成一个测试 AppID

---

## 第二步：导入小程序项目

### 2.1 打开微信开发者工具

1. 启动微信开发者工具
2. 点击左上角 **"+"** 或 **"导入项目"**

### 2.2 填写项目信息

- **项目目录**：`/Users/davidzhan/Desktop/重走长征路小程序/miniprogram`
- **AppID**：填写你获取的 AppID（或选择"测试号"）
- **项目名称**：重走长征路

点击 **"导入"**

---

## 第三步：配置服务器地址

### 3.1 修改 app.js

在微信开发者工具中：

1. 左侧文件列表找到 `app.js`
2. 找到这一行（大约第 8 行）：
   ```javascript
   serverUrl: 'https://your-server.com',
   ```
3. 改成：
   ```javascript
   serverUrl: 'http://localhost:3000',
   ```

### 3.2 配置开发设置（重要！）

1. 点击右上角 **"详情"** 按钮
2. 切换到 **"本地设置"** 标签
3. **勾选**：`不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书`

**这一步很重要！** 否则小程序无法访问 `http://localhost:3000`

---

## 第四步：准备图片资源（可选，但推荐）

根据 `IMAGES_README.md` 的说明，准备以下图片并放入 `miniprogram/images/` 目录：

**必需的图片**：
- `home.png` / `home-active.png` - 首页图标
- `ranking.png` / `ranking-active.png` - 排行榜图标  
- `map.png` / `map-active.png` - 长征路图标
- `profile.png` / `profile-active.png` - 我的图标
- `default-avatar.png` - 默认头像
- `longmarch-logo.png` - Logo（登录页用）

**临时方案**：如果暂时没有图片，可以：
- 使用纯色占位图
- 或者先用文字代替（后续再替换）

---

## 第五步：编译和测试

### 5.1 编译项目

1. 点击顶部 **"编译"** 按钮
2. 等待编译完成

### 5.2 测试功能流程

**测试登录流程**：
1. 在模拟器中看到登录页面
2. 选择一个处室（如"办公室"）
3. 点击"开始记录"
4. 应该跳转到首页

**测试首页**：
1. 查看今日步数显示（初始为 0）
2. 查看处室排名
3. 查看长征路进度

**测试同步步数**（需要真实 AppID 和微信运动授权）：
1. 点击"同步步数"按钮
2. 授权微信运动数据
3. 等待同步完成
4. 查看步数是否更新

**测试其他页面**：
- 点击底部 TabBar 切换页面
- 排行榜页面
- 长征路地图页面
- 个人中心页面

---

## 第六步：真机测试（可选）

### 6.1 预览到手机

1. 点击顶部 **"预览"** 按钮
2. 用微信扫描二维码
3. 在手机上测试

**注意**：真机测试时，手机无法访问 `localhost:3000`，需要：
- 将后端部署到公网服务器（有 HTTPS 域名）
- 或者使用内网穿透工具（如 ngrok）

---

## 常见问题

### Q1: 编译后显示空白页面或错误

**检查**：
- `app.js` 中的 `serverUrl` 是否正确
- 是否勾选了"不校验合法域名"
- 后端服务是否还在运行（`npm run dev` 的终端窗口不要关闭）

### Q2: 点击"同步步数"报错

**可能原因**：
- 没有配置真实的 AppID 和 AppSecret
- 用户没有授权微信运动数据
- 后端解密服务有问题

**解决**：
- 先确保 `.env` 文件中配置了正确的 `WECHAT_APPID` 和 `WECHAT_APPSECRET`
- 在微信中开启"微信运动"功能

### Q3: 数据库连接失败

**检查**：
- MySQL 服务是否运行：`brew services list | grep mysql`
- `.env` 文件中的数据库密码是否正确
- 数据库是否已初始化：`mysql -u root -p你的密码 -e "USE longmarch; SHOW TABLES;"`

### Q4: 图片显示不出来

**解决**：
- 检查图片路径是否正确
- 确保图片文件存在于 `miniprogram/images/` 目录
- 可以先使用占位图或纯色图片

---

## 成功标志

当你完成测试后，应该能够：

1. ✅ 小程序正常编译，无错误
2. ✅ 登录页面正常显示
3. ✅ 可以选择处室并进入首页
4. ✅ 首页显示个人和处室信息
5. ✅ 可以切换各个 TabBar 页面
6. ✅ 后端接口正常响应（查看 Network 面板）

---

## 下一步：完善功能

测试通过后，你可以：

1. **添加真实图片资源**
2. **配置真实的微信 AppID 和 AppSecret**
3. **测试完整的步数同步流程**
4. **准备部署到生产环境**（参考 `DEPLOYMENT.md`）

---

## 数据库自动存储说明

**是的，数据库会自动工作！** 当用户操作时：

1. **用户登录** → 自动保存到 `users` 表
2. **同步步数** → 自动保存到 `steps_records` 表
3. **查看统计** → 自动从数据库查询并计算
4. **处室排名** → 自动汇总各处室数据

**你不需要手动操作数据库**，所有操作都是通过后端 API 自动完成的！
