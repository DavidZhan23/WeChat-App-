# 快速修复真机预览空白页面

## 问题原因

真机预览显示空白页面，通常是因为：
1. **网络请求失败**：手机无法访问服务器
2. **IP 地址配置错误**：`config.js` 中的 IP 不是你的实际 IP
3. **网络环境问题**：手机和电脑不在同一 WiFi

## 三步快速修复

### 第一步：获取你的电脑 IP 地址

在终端执行：

```bash
ipconfig getifaddr en0
```

你会看到类似 `192.168.1.100` 的 IP 地址（**每个人的不同**）

### 第二步：更新 config.js

打开 `miniprogram/config.js`，找到这一行：

```javascript
testing: 'http://192.168.1.100:3000', // ⚠️ 请修改为你的实际 IP
```

**将 `192.168.1.100` 替换为你刚才获取的实际 IP 地址！**

例如，如果你的 IP 是 `192.168.0.105`，就改成：
```javascript
testing: 'http://192.168.0.105:3000',
```

### 第三步：测试并重新编译

1. **在手机浏览器测试**：
   - 打开手机浏览器
   - 访问：`http://你的IP:3000/health`
   - 应该看到：`{"status":"ok","message":"服务运行正常"}`
   - **如果看不到，说明网络有问题，检查 WiFi 和防火墙**

2. **重新编译小程序**：
   - 在微信开发者工具中保存所有文件
   - 点击"编译"
   - 点击"预览"生成新二维码

3. **清除缓存**（如果还有问题）：
   - 在开发者工具中：点击"清缓存" → "清除全部缓存"
   - 在手机上：删除小程序，重新扫码

## 我已经做的优化

✅ 添加了调试日志，可以在真机调试时查看：
- 服务器地址
- 环境类型
- 请求和响应信息

✅ 改进了环境判断逻辑，确保真机预览时使用正确的配置

## 如何查看调试信息

1. **在开发者工具中**：
   - 点击"调试" → "真机调试"
   - 查看 Console 面板
   - 应该能看到服务器地址和环境信息

2. **在手机上**：
   - 打开小程序
   - 在开发者工具中查看真机调试日志

## 如果还是空白页面

### 检查清单

- [ ] `config.js` 中的 IP 地址已更新为你的实际 IP
- [ ] 手机和电脑连接**同一个 WiFi**
- [ ] 手机浏览器能访问：`http://你的IP:3000/health`
- [ ] 后端服务正在运行（`npm run dev`）
- [ ] 已重新编译小程序
- [ ] 已清除缓存

### 查看错误信息

在开发者工具中：
1. 点击"调试" → "真机调试"
2. 查看 Console 面板的错误信息
3. 查看 Network 面板，检查请求是否成功

**常见错误**：
- `request:fail` - 网络请求失败，检查 IP 和网络
- `timeout` - 请求超时，检查服务器是否运行
- `404` - 接口不存在，检查后端路由

## 如果网络无法连接

### 使用内网穿透（推荐）

如果局域网 IP 不稳定，可以使用 ngrok：

1. **安装 ngrok**：
```bash
brew install ngrok
```

2. **启动**：
```bash
ngrok http 3000
```

3. **获取地址**（类似：`https://xxxxx.ngrok.io`）

4. **修改 config.js**：
```javascript
testing: 'https://xxxxx.ngrok.io',
```

5. **配置微信小程序域名**（在微信公众平台）

## 当前状态

✅ 已添加调试日志
✅ 已优化环境判断
✅ 已改进错误处理

**现在请**：
1. 获取你的电脑 IP
2. 更新 `config.js` 中的 IP
3. 测试手机浏览器能否访问
4. 重新编译并预览

如果还有问题，查看真机调试日志，告诉我具体的错误信息！
