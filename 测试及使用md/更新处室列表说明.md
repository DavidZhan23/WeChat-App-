# 更新处室列表说明

## 问题原因

小程序中的处室列表是**硬编码**在 `app.js` 中的，而数据库中的处室表是独立的。目前小程序**没有从数据库读取处室列表**，所以修改数据库不会自动更新小程序显示。

## 已修复

✅ 我已经更新了 `miniprogram/app.js` 中的处室列表，现在与数据库保持一致：
- 业务一部
- 业务二部
- 业务三部
- 业务四部
- 业务五部
- 业务六部
- 业务七部
- 业务八部

## 关于数据库

**不需要删除数据库！** 只需要：

### 如果数据库已经初始化过

只需要更新处室数据，执行以下 SQL：

```sql
-- 清空旧处室（可选）
DELETE FROM departments;

-- 插入新处室
INSERT INTO departments (name, description) VALUES
('业务一部', '业务一部'),
('业务二部', '业务二部'),
('业务三部', '业务三部'),
('业务四部', '业务四部'),
('业务五部', '业务五部'),
('业务六部', '业务六部'),
('业务七部', '业务七部'),
('业务八部', '业务八部')
ON DUPLICATE KEY UPDATE name=name;
```

### 如果数据库还没初始化

直接执行 `init.sql` 即可，它会自动创建所有表和插入处室数据。

## 测试步骤

1. **重新编译小程序**
   - 在微信开发者工具中点击"编译"
   - 应该能看到新的处室列表

2. **测试登录页面**
   - 打开登录页
   - 点击"选择处室"
   - 应该能看到：业务一部、业务二部...业务八部

3. **测试选择处室**
   - 选择一个处室（如"业务一部"）
   - 点击"开始记录"
   - 应该能正常跳转并保存

## 后续优化建议（可选）

如果想要更灵活的处室管理，可以：

### 方案：从数据库动态读取处室列表

1. **创建后端 API**：
```javascript
// server/routes/user.js 或新建 routes/department.js
router.get('/departments', async (req, res) => {
  const [rows] = await db.execute('SELECT name FROM departments ORDER BY id')
  res.json({
    code: 0,
    data: rows.map(row => row.name)
  })
})
```

2. **小程序启动时获取**：
```javascript
// app.js
onLaunch() {
  this.getDepartments() // 从服务器获取处室列表
  this.checkLogin()
},

getDepartments() {
  wx.request({
    url: `${this.globalData.serverUrl}/api/departments`,
    success: (res) => {
      if (res.data.code === 0) {
        this.globalData.departments = res.data.data
      }
    }
  })
}
```

**优点**：
- 处室列表可以动态管理
- 不需要修改代码，直接在数据库中添加/删除处室即可

**缺点**：
- 需要额外的 API 请求
- 启动时稍微慢一点

## 当前状态

✅ `app.js` 中的处室列表已更新
✅ 与数据库中的处室保持一致
✅ 小程序重新编译后即可看到新处室

## 重要提示

1. **重新编译**：修改 `app.js` 后必须重新编译小程序
2. **清除缓存**：如果还有问题，可以清除缓存后重新编译
3. **数据库同步**：确保数据库中的处室数据也是最新的（执行上面的 SQL）

现在请重新编译小程序，应该能看到新的处室列表了！
