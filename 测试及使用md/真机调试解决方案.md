# 真机调试解决方案

## 问题原因

**错误**：`Component is not found in path "wx://not-found"`  
**原因**：真机调试时，手机无法访问 `localhost:3000`

在真机调试时：
- **模拟器**：`localhost:3000` 指向你的电脑
- **真机**：`localhost:3000` 指向手机本身（找不到服务器）

## 解决方案（选择其中一个）

### 方案一：使用电脑的局域网 IP 地址（推荐，最简单）

#### 步骤 1：获取电脑的局域网 IP

**Mac 系统**：
```bash
# 在终端执行
ifconfig | grep "inet " | grep -v 127.0.0.1
```

或者：
```bash
ipconfig getifaddr en0
```

**Windows 系统**：
```bash
ipconfig
```
找到 "IPv4 地址"，通常是 `192.168.x.x` 或 `10.x.x.x`

#### 步骤 2：修改 app.js 中的 serverUrl

打开 `miniprogram/app.js`，找到：
```javascript
serverUrl: 'http://localhost:3000',
```

**临时修改为**（真机调试时）：
```javascript
serverUrl: 'http://192.168.1.100:3000',  // 替换为你的实际 IP
```

**注意**：每次电脑 IP 变化时都需要修改。

#### 步骤 3：确保手机和电脑在同一 WiFi

- 手机和电脑必须连接**同一个 WiFi 网络**
- 确保防火墙允许 3000 端口的连接

#### 步骤 4：测试连接

在手机浏览器中访问：`http://你的IP:3000/health`
- 如果能看到 JSON 响应，说明连接正常
- 如果无法访问，检查防火墙设置

---

### 方案二：使用内网穿透工具（适合长期开发）

#### 使用 ngrok（推荐）

1. **安装 ngrok**：
```bash
# Mac
brew install ngrok

# 或下载：https://ngrok.com/download
```

2. **启动内网穿透**：
```bash
ngrok http 3000
```

3. **获取公网地址**：
```
Forwarding: https://xxxxx.ngrok.io -> http://localhost:3000
```

4. **修改 app.js**：
```javascript
serverUrl: 'https://xxxxx.ngrok.io',  // 使用 ngrok 提供的地址
```

5. **配置微信小程序**：
- 登录微信公众平台
- 开发 → 开发管理 → 开发设置
- 在"服务器域名"中添加：`https://xxxxx.ngrok.io`

**优点**：
- 不需要手机和电脑在同一网络
- 地址稳定（免费版每次启动会变）
- 支持 HTTPS

**缺点**：
- 需要每次启动 ngrok
- 免费版地址会变化

#### 使用 natapp（国内推荐）

1. **注册账号**：https://natapp.cn
2. **下载客户端**
3. **配置隧道**（免费版会提供随机域名）
4. **启动**：
```bash
./natapp -authtoken=你的token
```
5. **使用提供的域名**修改 `app.js`

---

### 方案三：部署到公网服务器（生产环境）

参考 `DEPLOYMENT.md`，将后端部署到云服务器，使用 HTTPS 域名。

---

## 快速修复步骤（方案一）

### 1. 获取电脑 IP

在终端执行：
```bash
ifconfig | grep "inet " | grep -v 127.0.0.1
```

找到类似 `192.168.1.100` 的地址。

### 2. 修改 app.js

```javascript
// 开发环境：模拟器使用
// serverUrl: 'http://localhost:3000',

// 真机调试：使用局域网 IP
serverUrl: 'http://192.168.1.100:3000',  // 替换为你的实际 IP
```

### 3. 检查防火墙

**Mac**：
```bash
# 允许 3000 端口
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --add /usr/local/bin/node
```

**或者临时关闭防火墙测试**（不推荐，仅测试用）

### 4. 重新编译小程序

在微信开发者工具中：
1. 修改 `app.js` 后保存
2. 点击"编译"
3. 点击"预览"或"真机调试"

### 5. 测试连接

在手机浏览器访问：`http://你的IP:3000/health`
- 应该看到：`{"status":"ok","message":"服务运行正常"}`

---

## 常见问题

### Q1: 手机访问 IP 地址显示"无法连接"

**可能原因**：
1. 手机和电脑不在同一 WiFi
2. 防火墙阻止了连接
3. IP 地址错误

**解决**：
- 确认手机和电脑连接同一 WiFi
- 检查防火墙设置
- 重新获取 IP 地址

### Q2: 真机调试时显示空白页面

**可能原因**：
1. API 请求失败
2. 服务器未运行
3. 网络连接问题

**解决**：
1. 检查后端服务是否运行：`curl http://localhost:3000/health`
2. 查看手机浏览器能否访问：`http://你的IP:3000/health`
3. 在开发者工具的"调试器" → "Network" 查看请求是否成功

### Q3: 每次 IP 变化都要修改代码

**解决**：
- 使用内网穿透工具（ngrok/natapp）
- 或者部署到固定服务器

### Q4: 真机调试时出现 "Component is not found"

**可能原因**：
- 网络请求失败导致页面无法加载
- 组件路径错误

**解决**：
- 先确保网络连接正常
- 检查 `app.js` 中的 `serverUrl` 是否正确
- 查看 Console 中的具体错误信息

---

## 推荐的开发流程

### 开发阶段

1. **模拟器测试**：使用 `localhost:3000`
2. **真机调试**：使用局域网 IP 或内网穿透
3. **生产环境**：使用 HTTPS 域名

### 配置管理建议

可以创建一个配置文件来管理不同环境：

```javascript
// miniprogram/config.js
const config = {
  development: 'http://localhost:3000',  // 模拟器
  testing: 'http://192.168.1.100:3000',   // 真机调试（局域网 IP）
  production: 'https://your-domain.com'  // 生产环境
}

module.exports = config[process.env.NODE_ENV || 'development']
```

---

## 当前推荐操作

**最快解决方案**：

1. **获取电脑 IP**：
```bash
ifconfig | grep "inet " | grep -v 127.0.0.1
```

2. **修改 app.js**：
```javascript
serverUrl: 'http://你的IP:3000',  // 例如：http://192.168.1.100:3000
```

3. **确保手机和电脑在同一 WiFi**

4. **重新编译并真机调试**

---

## 测试清单

完成配置后，测试：

- [ ] 手机浏览器能访问：`http://你的IP:3000/health`
- [ ] 小程序能正常登录
- [ ] 小程序能正常显示数据
- [ ] 所有页面都能正常打开

如果所有测试通过，说明配置成功！🎉
