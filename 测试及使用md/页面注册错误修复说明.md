# 页面注册错误修复说明

## 错误信息

```
Component is not found in path "wx://not-found"
Page "pages/login/login" has not been registered yet.
```

## 问题原因

这个错误通常是因为：

1. **按需注入导致的加载顺序问题**：启用按需注入后，页面可能还没完全注册就尝试跳转
2. **app.js 中的逻辑执行过早**：在页面注册完成前就执行了页面跳转
3. **缺少页面配置文件**：`login.json` 文件缺失

## 已修复的问题

### 1. ✅ 添加了 login.json 配置文件

创建了 `miniprogram/pages/login/login.json`，确保页面配置完整。

### 2. ✅ 延迟执行登录检查

在 `app.js` 中，将 `checkLogin()` 的执行延迟 100ms，确保页面已注册：

```javascript
onLaunch() {
  // 延迟检查登录状态，确保页面已注册
  setTimeout(() => {
    this.checkLogin()
  }, 100)
}
```

### 3. ✅ 延迟页面跳转

在 `login.js` 中，延迟页面跳转，确保页面已完全加载：

```javascript
setTimeout(() => {
  wx.switchTab({
    url: '/pages/index/index'
  })
}, 200)
```

### 4. ✅ 延迟登录执行

在 `login.js` 中，延迟登录逻辑执行：

```javascript
setTimeout(() => {
  this.login()
}, 100)
```

## 测试步骤

1. **清除缓存**：
   - 在开发者工具中：点击"清缓存" → "清除全部缓存"
   - 在手机上：删除小程序，重新扫码

2. **重新编译**：
   - 保存所有文件
   - 点击"编译"
   - 点击"预览"生成新二维码

3. **测试流程**：
   - 用手机扫码
   - 应该能看到登录页面（不再报错）
   - 选择处室
   - 点击"开始记录"
   - 应该能正常跳转到首页

## 如果还有问题

### 问题1：还是显示 "Page has not been registered"

**解决**：
1. 检查 `app.json` 中 `pages` 数组的第一项是否是 `pages/login/login`
2. 确保所有页面文件都存在（.js, .wxml, .wxss, .json）
3. 清除缓存后重新编译

### 问题2：页面跳转失败

**解决**：
1. 检查页面路径是否正确
2. 确保使用 `wx.switchTab` 跳转 TabBar 页面
3. 确保使用 `wx.navigateTo` 或 `wx.redirectTo` 跳转普通页面

### 问题3：Component is not found

**解决**：
1. 检查是否有自定义组件路径错误
2. 检查 `app.json` 中的 `usingComponents` 配置
3. 确保组件文件存在

## 调试技巧

### 查看页面注册顺序

在 `app.js` 中添加：

```javascript
onLaunch() {
  console.log('App onLaunch')
  setTimeout(() => {
    console.log('开始检查登录')
    this.checkLogin()
  }, 100)
}
```

### 查看页面加载

在 `login.js` 中添加：

```javascript
onLoad() {
  console.log('Login page onLoad')
  this.setData({
    departments: app.globalData.departments
  })
  this.checkLogin()
}
```

## 当前状态

✅ 已添加 login.json 配置文件
✅ 已延迟 app.js 中的登录检查
✅ 已延迟页面跳转逻辑
✅ 已延迟登录执行

**现在请**：
1. 清除缓存
2. 重新编译
3. 重新预览测试

如果还有问题，查看真机调试日志，告诉我具体的错误信息！
