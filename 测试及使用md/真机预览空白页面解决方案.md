# 真机预览空白页面解决方案

## 问题分析

通过二维码用手机访问小程序显示空白页面，通常是因为：

1. **网络请求失败**：手机无法访问 `localhost:3000` 或局域网 IP
2. **配置问题**：`config.js` 中的 IP 地址不正确
3. **项目配置错误**：`project.private.config.json` 可能有配置问题

## 解决方案

### 第一步：检查并修复 project.private.config.json

这个文件通常是微信开发者工具自动生成的，如果报错，可以：

**选项1：删除这个文件**（推荐）
- 微信开发者工具会自动重新生成
- 这个文件通常不需要手动维护

**选项2：检查文件内容**
- 确保 JSON 格式正确
- 确保没有语法错误

### 第二步：确认 config.js 中的 IP 地址

打开 `miniprogram/config.js`，检查：

```javascript
testing: 'http://192.168.1.100:3000', // ⚠️ 请修改为你的实际 IP
```

**必须修改为你的电脑实际 IP 地址！**

**获取 IP 的方法**：
```bash
# Mac
ipconfig getifaddr en0

# 或者
ifconfig | grep "inet " | grep -v 127.0.0.1
```

### 第三步：测试网络连接

在手机浏览器中访问：`http://你的IP:3000/health`

**应该看到**：
```json
{"status":"ok","message":"服务运行正常"}
```

**如果无法访问**：
- 检查手机和电脑是否在同一 WiFi
- 检查防火墙设置
- 检查后端服务是否运行

### 第四步：检查开发者工具设置

1. **打开"详情" → "本地设置"**
2. **确保勾选**：`不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书`

### 第五步：查看真机调试日志

1. 在手机上打开小程序
2. 在微信开发者工具中，点击"调试" → "真机调试"
3. 查看 Console 中的错误信息
4. 查看 Network 面板，检查请求是否成功

## 常见问题排查

### Q1: 手机访问 IP 显示"无法连接"

**原因**：
- IP 地址错误
- 手机和电脑不在同一 WiFi
- 防火墙阻止连接

**解决**：
1. 重新获取电脑 IP
2. 更新 `config.js` 中的 IP
3. 确保手机和电脑在同一 WiFi
4. 检查防火墙设置

### Q2: 真机预览还是空白

**排查步骤**：

1. **检查后端服务**：
```bash
curl http://localhost:3000/health
```

2. **检查手机网络**：
   - 在手机浏览器访问：`http://你的IP:3000/health`
   - 如果无法访问，说明网络问题

3. **查看真机调试日志**：
   - 在开发者工具中查看 Console
   - 查看 Network 面板的请求状态

4. **检查 config.js**：
   - 确认 IP 地址正确
   - 确认环境判断逻辑正确

### Q3: project.private.config.json 报错

**解决**：
- 删除这个文件，让开发者工具重新生成
- 或者检查 JSON 格式是否正确

## 快速修复步骤

### 1. 获取电脑 IP

```bash
ipconfig getifaddr en0
```

### 2. 更新 config.js

将 `testing` 中的 IP 改为你的实际 IP：
```javascript
testing: 'http://你的实际IP:3000',
```

### 3. 测试连接

在手机浏览器访问：`http://你的IP:3000/health`

### 4. 重新编译

在微信开发者工具中：
- 保存所有文件
- 点击"编译"
- 点击"预览"生成新二维码

### 5. 清除缓存

如果还有问题：
- 在开发者工具中点击"清缓存" → "清除全部缓存"
- 在手机上删除小程序，重新扫码

## 如果还是不行

### 使用内网穿透（推荐）

如果局域网 IP 不稳定或无法使用，可以使用内网穿透：

1. **安装 ngrok**：
```bash
brew install ngrok
```

2. **启动内网穿透**：
```bash
ngrok http 3000
```

3. **获取公网地址**：
```
Forwarding: https://xxxxx.ngrok.io -> http://localhost:3000
```

4. **修改 config.js**：
```javascript
testing: 'https://xxxxx.ngrok.io',
```

5. **配置微信小程序域名**：
- 登录微信公众平台
- 开发 → 开发管理 → 开发设置
- 添加服务器域名：`https://xxxxx.ngrok.io`

## 调试技巧

### 查看真机日志

1. 在开发者工具中，点击"调试" → "真机调试"
2. 查看 Console 面板的错误信息
3. 查看 Network 面板的请求状态

### 添加调试信息

在 `app.js` 中添加：

```javascript
onLaunch() {
  console.log('服务器地址:', this.globalData.serverUrl)
  console.log('环境:', config.env)
  this.checkLogin()
}
```

这样可以在真机调试时看到实际使用的服务器地址。

## 当前状态检查清单

- [ ] `config.js` 中的 IP 地址已更新为实际 IP
- [ ] 手机和电脑在同一 WiFi
- [ ] 手机浏览器能访问：`http://你的IP:3000/health`
- [ ] 后端服务正在运行
- [ ] 开发者工具中勾选了"不校验合法域名"
- [ ] 已重新编译小程序
- [ ] 已清除缓存

如果所有项目都完成，真机预览应该可以正常显示了！
